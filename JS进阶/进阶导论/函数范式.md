## é«˜é˜¶å‡½æ•°èŒƒå¼ï¼š

> **ğŸ”” é‡ç‚¹ï¼š** æœ¬ç« å†…å®¹æˆ‘ä»¬å›´ç»•å‡½æ•°èŒƒå¼æ¥è§£é‡Šå‡½æ•°çš„è¿‡ç¨‹æ˜¯å¦‚ä½•æŠ½è±¡çš„ï¼›
>
> - HOF0 æ˜¯é«˜é˜¶å‡½æ•°çš„ç­‰ä»·èŒƒå¼ï¼Œæˆ–è€…è¯´ï¼ŒHOF0 ä¿®é¥°çš„å‡½æ•°åŠŸèƒ½å’ŒåŸå‡½æ•° fn çš„åŠŸèƒ½å®Œå…¨ç›¸åŒã€‚
> - å¯ä»¥å‘ç°è¢«ä¿®é¥°åçš„å‡½æ•°å°±åªæ˜¯é‡‡ç”¨è°ƒç”¨çš„ this ä¸Šä¸‹æ–‡å’Œå‚æ•°æ¥è°ƒç”¨ fnï¼Œå¹¶å°†ç»“æœè¿”å›ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰§è¡Œå®ƒå’Œç›´æ¥æ‰§è¡Œ fn å®Œå…¨æ²¡åŒºåˆ«ã€‚

```js
// å‡½æ•°èŒƒå¼
function HOF0(fn) {
  return function (...args) {
    return fn.apply(this, args);
  };
}
```

**ğŸŒ° åªæ‰§è¡Œä¸€æ¬¡ï¼š** æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸€äº›å¤„ç†å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡çš„æƒ…å†µï¼š

```html
<!-- css -->
<style>
  ul {
    padding: 0;
    margin: 0;
    list-style: none;
  }

  li button {
    border: 0;
    background: transparent;
    cursor: pointer;
    outline: 0 none;
  }

  li.completed {
    transition: opacity 2s;
    opacity: 0;
  }

  li button:before {
    content: "â˜‘ï¸";
  }

  li.completed button:before {
    content: "âœ…";
  }
</style>

<!-- html -->
<ul>
  <li><button></button><span>ä»»åŠ¡ä¸€ï¼šå­¦ä¹ HTML</span></li>
  <li><button></button><span>ä»»åŠ¡äºŒï¼šå­¦ä¹ CSS</span></li>
  <li><button></button><span>ä»»åŠ¡ä¸‰ï¼šå­¦ä¹ JavaScript</span></li>
</ul>

<!-- js -->
<script>
   const list = document.querySelector("ul");
   const btns = list.querSelectorAll("button");

  btns.addEventListener('click', (event)=>{
  	const target = event.target
  	target.parentNode.className = 'completed'
  	setTimeout(()={
  	list.removeChild(target.parentNode)
  }, 2000)
  })
</script>
```

> **â— Tipï¼š** è¿™æ ·å†™ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜
>
> - åœ¨åˆ—è¡¨æ¶ˆå¤±å‰å¦‚æœå¤šæ¬¡è§¦å‘æŒ‰é’®äº‹ä»¶ï¼Œæ§åˆ¶å°ä¼šåé¦ˆå¼‚å¸¸ä¿¡æ¯ï¼šå› ä¸ºå¤„ç†å‡½æ•°ä¼šåœ¨ 2S åç§»é™¤æ‰ï¼Œæ‰€ä»¥åç»­çš„å®šæ—¶å™¨å›è°ƒå‡½æ•°å†è¢«æ‰§è¡Œæ—¶å°±ä¼šè¢«æŠ›å‡ºå¼‚å¸¸ï¼›

**ğŸŒˆ once å‚æ•°ï¼š** é€šè¿‡é™åˆ¶ click å›è°ƒçš„æ‰§è¡Œæ¬¡æ•°ä¸ºä¸€æ¬¡ï¼Œè§£å†³é—®é¢˜

```js
// åœ¨æ–°ç‰ˆæœ¬çš„æµè§ˆå™¨å†…ï¼Œå¯ä»¥é€šè¿‡adEventListenerçš„onceå‚æ•°æ¥å®ç°åªæ‰§è¡Œä¸€æ¬¡çš„æ•ˆæœ

const list = document.querySelector("ul");
const buttons = list.querySelectorAll("button");
buttons.forEach((button) => {
  button.addEventListener(
    "click",
    (evt) => {
      const target = evt.target;
      target.parentNode.className = "completed";
      setTimeout(() => {
        list.removeChild(target.parentNode);
      }, 2000);
    },
    { once: true }
  );
});
```

**ğŸŒˆ removeEventListener æ–¹æ³•ï¼š** éƒ¨åˆ†æ—§ç‰ˆæœ¬çš„æµè§ˆå™¨å¯èƒ½å¹¶ä¸æ”¯æŒ once å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ç§»é™¤ç›‘å¬å™¨çš„æ–¹å¼æ¥å®ç°åŒæ ·çš„æ•ˆæœ

```js
const list = document.querySelector("ul");
const buttons = list.querySelectorAll("button");
buttons.forEach((button) => {
  button.addEventListener("click", function f(evt) {
    const target = evt.target;
    target.parentNode.className = "completed";
    setTimeout(() => {
      list.removeChild(target.parentNode);
    }, 2000);
    target.removeEventListener("click", f);
  });
});
```

**ğŸŒˆ disabled å±æ€§ï¼š** ä½¿ç”¨å…ƒç´ çš„ disabled å±æ€§æ¥é™åˆ¶ç›®æ ‡å…ƒç´ åªèƒ½è¢«ç‚¹å‡»ä¸€æ¬¡çš„æ•ˆæœ

```js
const list = document.querySelector("ul");
const buttons = list.querySelectorAll("button");
buttons.forEach((button) => {
  button.addEventListener("click", (evt) => {
    const target = evt.target;
    target.parentNode.className = "completed";
    setTimeout(() => {
      list.removeChild(target.parentNode);
    }, 2000);
    target.disabled = true;
  });
});
```

> **â“ æ€è€ƒï¼š**
>
> - äº‹ä»¶å¤„ç†æ–¹æ³•æ‰§è¡Œä¸€æ¬¡çš„éœ€æ±‚è¿˜æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚è´­ç‰©è½¦æäº¤æ•°æ®ç»™æœåŠ¡å™¨åï¼ŒæŒ‰é’®åœ¨ç‚¹å‡»ä¸€æ¬¡åæˆ‘ä»¬å¸Œæœ›æŒ‰é’®å†æ¬¡è¢«ç‚¹å‡»æ—¶ä¸ä¼šè§¦å‘äº‹ä»¶æˆ–è€…å°†æŒ‰é’®ç¦ç”¨ï¼›
> - **ä»¥ä¸Šè¿™äº›è§£å†³æ–¹å¼åœ¨ä¸åŒçš„éœ€æ±‚ä¸­éƒ½å¿…é¡»ä¸æ–­çš„é‡å¤ã€‚**é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰é€šç”¨çš„åŠæ³•è¦†ç›–æ‰€æœ‰åªéœ€æ‰§è¡Œä¸€æ¬¡çš„éœ€æ±‚å‘¢ï¼Ÿ

## æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹æ­£å¼çš„å¼•å‡ºæˆ‘ä»¬æœ¬ç« çš„ä¸»è§’ï¼š**å‡½æ•°èŒƒå¼**

> **ğŸ”” å‡½æ•°è£…é¥°å™¨ï¼š**
>
> - ä¸Šè¾¹æˆ‘ä»¬æåˆ°äº†å„ç§è§£å†³æ–¹å¼çš„é‡å¤å‡ºç°æ˜¯å¦æœ‰åˆç†çš„è§£å†³æ–¹æ¡ˆï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼š
> - æˆ‘ä»¬å°†è¿™ä¸ª **â€œé‡å¤â€**çš„éœ€æ±‚ä»äº‹ä»¶å¤„ç†å‡½æ•°ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬ç§°ä¸º **è¿‡ç¨‹æŠ½è±¡**ã€‚

**ğŸŒˆ once å‡½æ•°ï¼š**

```js
function once(fn) {
  return function (...args) {
    if (fn) {
      const ret = fn.apply(this, args);
      fn = null;
      return ret;
    }
  };
}
```

> âœ¨ ç°åœ¨æˆ‘ä»¬é€šè¿‡å¯¹ fn ç›®æ ‡äº‹ä»¶è¿›è¡Œä¿®é¥°å¾—åˆ°äº† once è¿™ä¸ªå‡½æ•°ï¼Œè¿™é‡Œ once å°±ç§°ä¸º**å‡½æ•°è£…é¥°å™¨**ã€‚
>
> - once å‡½æ•°å‚æ•° fn æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ˆè¦ä¿®é¥°çš„ç›®æ ‡äº‹ä»¶å‡½æ•°ï¼‰ï¼Œä»–çš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œè¿™ä¸ªå‡½æ•°å°±æ˜¯â€œåªæ‰§è¡Œä¸€æ¬¡çš„â€è¿‡ç¨‹æŠ½è±¡ï¼›

**ğŸŒ° åªæ‰§è¡Œä¸€æ¬¡ï¼š** æˆ‘ä»¬æ¥ç€ä¸Šè¾¹çš„ä¾‹å­è¿›è¡Œä¿®æ”¹å®ç°

```js
const list = document.querySelector('ul');
const buttons = list.querySelectorAll('button');

buttons.forEach((button) => {
  button.addEventListener('click', once((evt) => {
    const target = evt.target;
    target.parentNode.className = 'completed';
    setTimeout(() => {
      list.removeChild(target.parentNode);
    }, 2000);
  }));
});
formEl.addEventListener('submit', once((evt) => {
  fetch('path/to/url', {
    method: 'POST',
    body: JSON.stringify(formData),
    ...
  });
}));


// æ‹“å±•onceä¸šåŠ¡ åœ¨å¤šæ¬¡æ‰§è¡Œçš„æƒ…å†µä¸‹æŠ›å‡ºå¼‚å¸¸ï¼Œé€šçŸ¥ç”¨æˆ·
function once(fn, replacer = null) {
  return function (...args) {
    if(fn) {
      const ret = fn.apply(this, args);
      fn = null;
      return ret;
    }
    if(replacer) {
      return replacer.apply(this, args);
    }
  };
}

const obj = {
  init: once(() => {
    console.log('Initializer has been called.');
  }, () => {
    throw new Error('This method should be called only once.');
  }),
}

obj.init();
obj.init();
```

> è¿™æ ·æˆ‘ä»¬åªéœ€è¦å…³å¿ƒè¡¨å•æäº¤çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸éœ€è¦å†æ·»åŠ å¯¹äº‹ä»¶è¿›è¡Œé™åˆ¶çš„æ‰§è¡Œæ¬¡æ•°çš„è¯­å¥äº†ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥åœ¨ once çš„åŸºç¡€ä¸Šè¿›è¡Œæ‹“å±•è¿›è¡Œå¯¹ä¸šåŠ¡çš„ä¸°å¯Œã€‚

**ğŸŒ° èŠ‚æµé˜²æŠ–ï¼š**
**èŠ‚æµï¼š** è®©äº‹ä»¶å¤„ç†å‡½æ•°éš”ä¸€ä¸ªæŒ‡å®šæ¯«ç§’å†è§¦å‘

```html
<!-- css -->
<style>
  html,
  body {
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0;
  }
  #panel {
    display: inline-block;
    width: 360px;
    height: 360px;
    background: hsl(0, 50%, 50%);
  }
</style>

<!-- html -->
<div id="panel"></div>

<!-- js -->
<script>
  const panel = document.getElementById("panel");

  panel.addEventListener(
    "mousemove",
    throttle((e) => {
      // é¢œè‰²çš„ä¿®æ”¹é€»è¾‘
      const { x, y } = e;
      e.target.style.background = `linear-gradient(${y}deg, 
			hsl(0, 50%, 50%),
			hsl(${0.5 * x}, 50%, 50%))`;

      // å‘æœåŠ¡å™¨å‘é€å½“å‰é¢œè‰²é…è‰²ä¿¡æ¯
      saveToServe(...data);
    })
  );

  // å°è£…ä¸€ä¸ªèŠ‚æµthrottleå‡½æ•°è£…é¥°å™¨ï¼Œä»–é™åˆ¶æŸä¸ªå‡½æ•°åœ¨msé—´éš”ä¸­åªæ‰§è¡Œä¸€æ¬¡ï¼š
  function throttle(fn, sm = 100) {
    let timer = null;
    return function (...args) {
      if (!timer) {
        const res = fn.apply(this, args);
        timer = setTimeout(() => {
          timer = null;
        }, ms);
        return res;
      }
    };
  }
  // æˆ‘ä»¬å¯ä»¥åˆ©ç”¨throttleæ¥æ¨¡æ‹Ÿonce
  function once() {
    throttle(fn, Infinity);
  }
</script>
```

**é˜²æŠ–ï¼š** å¿½ç•¥ä¸­é—´çš„æ“ä½œï¼Œåªå“åº”ç”¨æˆ·æœ€åä¸€æ¬¡æ“ä½œ

```html
<!-- css -->
<style>
  html,
  body {
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0;
  }
  #panel {
    width: 100%;
    height: 0;
    padding-bottom: 100%;
  }
</style>

<!-- html -->
<div id="panel">
  <canvas></canvas>
</div>

<!-- js -->
<script>
  const panel = document.getElementById("panel");
  const canvas = document.querySelector("canvas");
  function resize() {
    canvas.width = panel.clientWidth;
    canvas.height = panel.clientHeight;
  }
  function draw() {
    const context = canvas.getContext("2d");
    const radius = canvas.width / 2;
    context.save();
    context.translate(radius, radius);
    for (let i = radius; i >= 0; i -= 5) {
      context.fillStyle = `hsl(${i % 360}, 50%, 50%)`;
      context.beginPath();
      context.arc(0, 0, i, i, 0, Math.PI * 2);
      context.fill();
    }
    context.restore();
  }
  // åœ¨ä¸è¿›è¡Œé˜²æŠ–æ“ä½œæ—¶ï¼Œé€šè¿‡æ‹–æ‹½æ”¹å˜çª—å£æ”¹å˜å¤§å°æ—¶ï¼Œä¼šå‡ºç°å¡é¡¿ç°è±¡ï¼›å› ä¸ºçª—å£å°ºå¯¸çš„æ”¹å˜è‡´ä½¿resizeäº‹ä»¶ä¼šåå¤è§¦å‘
  // è§£å†³å¡é¡¿ï¼šè®©ç”¨æˆ·åœ¨æ“ä½œè¿‡ç¨‹ä¸­ï¼Œä¸ç»˜åˆ¶Canvasï¼Œåªåœ¨ç”¨æˆ·æœ€åä¸€æ¬¡æ”¹å˜çª—å£å¤§å°çš„æ“ä½œåæ‰é‡æ–°ç»˜åˆ¶Canvasã€‚
  resize();
  draw();

  window.addEventListener(
    "resize",
    debounce(() => {
      resize();
      draw();
    }, 500)
  );

  // å°è£… debounce
  function debounce(fn, ms = 500) {
    let timer = null;
    return (...args) => {
      timer && clearTimeout(timer);
      timer = setTimeout(() => fn(args), ms);
    };
  }
</script>
```

> **âœ¨ é«˜é˜¶å‡½æ•°ï¼š** æˆªæ­¢ç›®å‰ä¸ºæ­¢æˆ‘ä»¬æ‰€ä¸¾åˆ°çš„æ‰€æœ‰ä¾‹å­éƒ½æœ‰ä¸€ä¸ªå…±åŒç‰¹ç‚¹ -- å‚æ•°ã€è¿”å›å€¼éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œæˆ‘ä»¬æŠŠè¿™ç±»å‹çš„å‡½æ•°ç§°ä¸º **é«˜é˜¶å‡½æ•°**ï¼›
> **âœ¨ æˆ‘ä»¬å°†ä¿®é¥°å‡½æ•°ç§°ä¸ºé«˜é˜¶å‡½æ•°ï¼Œé‚£ä¹ˆé«˜é˜¶å‡½æ•°è¿˜å­˜åœ¨å“ªäº›åº”ç”¨ï¼Ÿ**
